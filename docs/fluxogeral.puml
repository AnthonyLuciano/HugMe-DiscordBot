@startuml FluxoGeral
participant Usuário
participant Bot
participant BancoDados
participant "Web Admin" as Web
participant "API Discord" as DiscordAPI
participant "API Ko-fi" as KoFiAPI
participant "API DeepSeek" as DeepSeek

' Fluxo de Doação via PIX
Usuário -> Bot: /doar
Bot -> Usuário: Mostra confirmação (DMConfirmationView)
Usuário -> Bot: Confirma doação
Bot -> BancoDados: Registra transação PIX
Bot --> Usuário: Mostra QR Code estático

' Fluxo de Doação via Ko-fi (Webhook)
KoFiAPI -> Web: Webhook de confirmação
Web -> BancoDados: Registra doação Ko-fi
Web -> Bot: Solicita atribuição de cargo
Bot -> DiscordAPI: Atribui cargo automaticamente
Bot -> BancoDados: Marca cargo como atribuído

' Fluxo de Conversação com IA
Usuário -> Bot: /bot <mensagem>
Bot -> DeepSeek: Envia prompt
DeepSeek --> Bot: Retorna resposta
Bot -> DiscordAPI: Envia resposta mencionando usuário
Bot -> BancoDados: Log da interação

' Fluxo de Verificação de Cargo
Usuário -> Bot: /verificarcargo (staff only)
Bot -> DiscordAPI: Verifica permissões admin
DiscordAPI --> Bot: Confirma admin
Bot -> Usuário: Cria botão de verificação
Usuário -> Bot: Clica para verificar cargo
Bot -> BancoDados: Verifica tempo no servidor
Bot -> DiscordAPI: Atribui cargo

' Fluxo Web Admin
Web -> Bot: Acessa /admin
Bot -> DiscordAPI: Verifica permissões
DiscordAPI --> Bot: Confirma admin
Bot -> BancoDados: Obtém métricas e apoiadores
Bot --> Web: Renderiza admin.html

' Fluxo de Comandos Básicos
Usuário -> Bot: /check
Bot --> Usuário: "Bot está online!"

Usuário -> Bot: /ajuda
Bot --> Usuário: Mostra embed com comandos

' Fluxo de Configuração QR Code (Admin)
Usuário -> Bot: /set_qrcode <url>
Bot -> BancoDados: Atualiza URL do QR Code
Bot --> Usuário: Confirmação de atualização

' Fluxo de Expiração Automática
Bot -> BancoDados: Verifica apoios expirados (cron)
BancoDados --> Bot: Lista de expirados
Bot -> DiscordAPI: Remove cargos expirados
Bot -> BancoDados: Atualiza status para inativo
@enduml